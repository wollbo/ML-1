function [X,S]=rand(h,nSamples)%[X,S]=rand(h,nSamples);generates a random sequence of data%from a given Hidden Markov Model.%%Input:%h=         HMM object%nSamples=  maximum no of output samples (scalars or column vectors)%%Result:%X= matrix or row vector with output data samples%S= row vector with corresponding integer state values%   obtained from the h.StateGen component.%   nS= length(S) == size(X,2)= number of output samples.%   If the StateGen can generate infinite-duration sequences,%       nS == nSamples%   If the StateGen is a finite-duration MarkovChain,%       nS <= nSamples%%----------------------------------------------------%Code Author: Hilding Wollbo 2019%----------------------------------------------------if numel(h)>1    error('Method works only for a single object');endS = zeros(1,nSamples);iI = DiscreteD(h.StateGen.InitialProb);S(1) = iI.rand(1); % consider the case where state 1 == endstate -- Should be ok since InitialProb for endstate is 0X(:,1) = h.OutputDistr(S(1)).rand(1); % X is a column vector --> stream of column vector observations nS = h.StateGen.nStates;for i = 2:nSamples    iT = DiscreteD(h.StateGen.TransitionProb(S(i-1),:)); % could be expanded to vector     S(i) = iT.rand(1);    if S(i) == nS+1        S = S(1:i); % could perhaps be enough to have only in MarkovChain.rand         break    end    X(:,i) = h.OutputDistr(S(i)).rand(1);end